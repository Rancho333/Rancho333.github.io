<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Rancho Blog</title>
    <link>https://rancho333.github.io/</link>
    
    <atom:link href="https://rancho333.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>No pain, no gain!</description>
    <pubDate>Wed, 19 Nov 2025 03:01:51 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>eveng中部署openwrt</title>
      <link>https://rancho333.github.io/2025/11/19/eveng%E4%B8%AD%E9%83%A8%E7%BD%B2openwrt/</link>
      <guid>https://rancho333.github.io/2025/11/19/eveng%E4%B8%AD%E9%83%A8%E7%BD%B2openwrt/</guid>
      <pubDate>Wed, 19 Nov 2025 01:52:26 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;实验需求&quot;&gt;&lt;a href=&quot;#实验需求&quot; class=&quot;headerlink&quot; title=&quot;实验需求&quot;&gt;&lt;/a&gt;实验需求&lt;/h2&gt;&lt;p&gt;在eveng中添加OpenWrt镜像, 在Openwrt中使能OpenClash服务，使得lab环境中所有连接到openwrt的节点能够访问google服务。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="实验需求"><a href="#实验需求" class="headerlink" title="实验需求"></a>实验需求</h2><p>在eveng中添加OpenWrt镜像, 在Openwrt中使能OpenClash服务，使得lab环境中所有连接到openwrt的节点能够访问google服务。</p><span id="more"></span><p>实验拓扑如下图所示：<br><img src="https://rancho333.github.io/pictures/eveng_openwrt-topology.png"></p><p>其中Net是lab的出口网关，本质是Vmware中的虚拟网卡VMnet8(NAT模式), Router1是Openwrt，wan口与Net连接。Client作为终端设备，与Openwrt的lan口连接。</p><h2 id="Openwrt部署"><a href="#Openwrt部署" class="headerlink" title="Openwrt部署"></a>Openwrt部署</h2><p>在<a href="https://github.com/Emerosn/OpenWrt-Eve-ng">github</a>上找到一个openwrt的qemu镜像，直接按照readme中的方式集成到eveng中，注意需要关闭windows中hyper-v功能。</p><p>之后就可以通过网页配置openwrt.<br><img src="https://rancho333.github.io/pictures/eveng_openwrt-control.png"></p><p>简单配置lan口上的dhcp，使client能够获取到ip.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@client:&#x2F;# ifconfig eth0</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 50:00:00:03:00:00  </span><br><span class="line">          inet addr:192.168.0.11  Bcast:192.168.0.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::5200:ff:fe03:0&#x2F;64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:1265 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:1245 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:2892497 (2.7 MiB)  TX bytes:105530 (103.0 KiB)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时client可以正常访问<code>www.baidu.com</code>, 但是无法访问google.</p><h2 id="OpenClash部署"><a href="#OpenClash部署" class="headerlink" title="OpenClash部署"></a>OpenClash部署</h2><p>这个版本的openwrt中并没有直接集成OpenClash, 按照下面的命令进行安装。</p><p>安装iptables及依赖。也可以使用nftables.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install bash iptables dnsmasq-full curl ca-bundle ipset ip-full iptables-mod-tproxy iptables-mod-extra ruby ruby-yaml kmod-tun kmod-inet-diag unzip luci-compat luci luci-base</span><br></pre></td></tr></table></figure><p>下载openclash安装包并安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;vernesong&#x2F;OpenClash&#x2F;releases&#x2F;download&#x2F;v0.47.028&#x2F;luci-app-openclash_0.47.028_all.ipk -O openclash.ipk</span><br><span class="line">opkg install openclash.ipk</span><br></pre></td></tr></table></figure><p>注意去github上下载最新的版本，不然安装好还要更新。</p><p>之后就可以在网页上看到openclash服务。<br><img src="https://rancho333.github.io/pictures/eveng_openwrt-openclash.png"></p><p>在配置订阅中添加自己的机场订阅链接.<br><img src="https://rancho333.github.io/pictures/eveng_openclash-subscribe.png"></p><p>之后做几处设置：<code>Plugin Setting  ——&gt;  DNS setting</code> 中关闭 <code>Redirect Local DNS Setting</code><br>确保<code>Traffic Control</code>中的<code>Wan interface name</code>列表是空。</p><h2 id="外网测试"><a href="#外网测试" class="headerlink" title="外网测试"></a>外网测试</h2><p>配置完成之后，openclash页面中的Access Check可以全部pass.<br><img src="https://rancho333.github.io/pictures/eveng_openclash-access.png"></p><p>在client上测试能够正常访问google.<br><img src="https://rancho333.github.io/pictures/eveng_openclash-google.png"></p>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/eveng/">eveng</category>
      
      <category domain="https://rancho333.github.io/tags/openwrt/">openwrt</category>
      
      
      <comments>https://rancho333.github.io/2025/11/19/eveng%E4%B8%AD%E9%83%A8%E7%BD%B2openwrt/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>lab考试基本介绍及考题分析</title>
      <link>https://rancho333.github.io/2025/06/19/lab%E8%80%83%E8%AF%95%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E5%8F%8A%E8%80%83%E9%A2%98%E5%88%86%E6%9E%901.2/</link>
      <guid>https://rancho333.github.io/2025/06/19/lab%E8%80%83%E8%AF%95%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E5%8F%8A%E8%80%83%E9%A2%98%E5%88%86%E6%9E%901.2/</guid>
      <pubDate>Thu, 19 Jun 2025 16:18:42 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;lab基本介绍&quot;&gt;&lt;a href=&quot;#lab基本介绍&quot; class=&quot;headerlink&quot; title=&quot;lab基本介绍&quot;&gt;&lt;/a&gt;lab基本介绍&lt;/h1&gt;&lt;p&gt;EI CCIE lab考试总共分为两个部分，第一部分是design，全部是笔试，共计39题(第一题介绍，最后一题say goodby)，3小时内完成；第二部分是DOO(deploy，operate，optimize)，共计5小时。design做完可以提前交卷，3小时中剩下的时间则直接作废，不会加给DOO使用。DOO就是lab实操了，主要分为三块，一是传统网络，二是SDN网络，三是自动化。传统网络共计16个小题，SDN网络共计6个小题，自动化共计三个小题，每个部分中都有一个选择题。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="lab基本介绍"><a href="#lab基本介绍" class="headerlink" title="lab基本介绍"></a>lab基本介绍</h1><p>EI CCIE lab考试总共分为两个部分，第一部分是design，全部是笔试，共计39题(第一题介绍，最后一题say goodby)，3小时内完成；第二部分是DOO(deploy，operate，optimize)，共计5小时。design做完可以提前交卷，3小时中剩下的时间则直接作废，不会加给DOO使用。DOO就是lab实操了，主要分为三块，一是传统网络，二是SDN网络，三是自动化。传统网络共计16个小题，SDN网络共计6个小题，自动化共计三个小题，每个部分中都有一个选择题。</p><span id="more"></span><p>这个系列的blog主要用来对当前版本lab的网络做一个基本分析，注意在2023年9月之后lab会改版。</p><h1 id="lab-拓扑全景"><a href="#lab-拓扑全景" class="headerlink" title="lab 拓扑全景"></a>lab 拓扑全景</h1><p>整个lab的所有设备及连接如下图所示：</p><p><img src="https://rancho333.github.io/pictures/lab1.1_topology.drawio.png"></p><p>这个图实际上还是很复杂的，总共由10个sites组成，分别是：</p><ul><li>HQ(head quarter)：主要跑ospf, eigrp v6，bgp等，虽然r12和ISP互联，但是默认从DC访问互联网</li><li>DC(data center)：整个网络的中心，跑ospf, dmvpn，eigrp等，DHCP server, DMVPN hub, viptela，DNAc都部署在里面</li><li>IaaS(Infrastructure as a service) 主要用来做自动化，以及ping通R30的ipv6 loopback</li><li>ISP(Internet service provider) 提供8.8.8.8，并且会通过BGP下发默认路由</li><li>SP1(service provider 1) 主要跑mpls,bgp，起到连接各个sites的作用</li><li>SP2 同SP1，上面只跑BGP</li><li>Branch1 分支1，跑SDN，viptela的overlay是DNAc的underlay，viptela在vedge之间构建好vpn通道，DNAc基于此对物理交换机进行纳管，注意SW400是border/edge两种角色一体</li><li>Branch2 分支2，跑SDN，大部分同branch1, sw501和sw502是border角色，sw510是edge</li><li>Branch3 分支3，跑DMVPN，作为spoken</li><li>Branch4 分支4，跑DMVPN，作为spoken</li></ul><p>最终的目的其实很简单，就是使用L2，L3，SDN等网络技术使所有主机都获取到ip地址，并能访问ISP中的8.8.8.8(google DNS服务器)，当然，HQ,DC,IaaS，branch1,branch2,branch3,branch4之间也是互联互通的，即这些sites中的主机都可以ping通的，guest vpn除外。</p><h2 id="传统1-2"><a href="#传统1-2" class="headerlink" title="传统1.2"></a>传统1.2</h2><p>1.1是introduction，直接pass了。下面是1.2的题目。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">layer 2 technologies in HQ</span><br><span class="line"></span><br><span class="line">Complete and correct the etherchannel configuration between switches sw101,sw102,sw110 according to these requirements：</span><br><span class="line">1. At the end of the task，all ethernetchannels between switches sw101, sw102 must be up and operational including all their physical member links</span><br><span class="line">2. Do not create new port-channel interfaces; reuse that already exist on the switches</span><br><span class="line">3. When resolving existing issues，do not change the preconfigured negotiation protocol（if any）</span><br><span class="line">4. On ethernetchannel that use a negotiation protocol，tune its mode of operation for the shortest link bunding time possible</span><br><span class="line"></span><br><span class="line">Configure VTP version 3 on these switches as follows:</span><br><span class="line">1. VTP domain must be set to CCIE</span><br><span class="line">2. VTP password must be cc1E@fab</span><br><span class="line">3. When displayed, the VTP password must be shown as 32-character hexadecimal string</span><br><span class="line">4. sw101 must be configured as VTP server for the MST feature</span><br><span class="line">5. sw102 &amp; sw110 must be configured as VTP client for the MST feature</span><br><span class="line"></span><br><span class="line">These switches must run MST and maintain 3 instances including the default instance 0 as follows：</span><br><span class="line">1. Associate vlans 1001-2000 in instance 1</span><br><span class="line">2. Associate vlans 2001-4094 in instance 2</span><br><span class="line">3. sw101 must be root for the default instance 0 and instance 1</span><br><span class="line">4. sw102 must be root for instance 2</span><br></pre></td></tr></table></figure><p>1.2的拓扑示意如下：</p><p><img src="https://rancho333.github.io/pictures/lab_1.2.png"></p><p>结构很简单，涉及到三台设备：sw101,sw102,sw110，三台交换机之间通过portchannel连接，其中sw101和sw110之间走staic，其它两条走LACP。配置思路如下</p><ul><li>修复portchannel配置，打通二层连接</li><li>配置VTP，其中sw101作为VTP server, 另外两台作为vtp client</li><li>配置mst，其中sw101作为instance 0-1的根，sw102作为instance 2的根</li></ul><p>下面是实际配置：</p><ol><li>修复portchannel配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sw101：</span><br><span class="line">int range gi 1&#x2F;2-3</span><br><span class="line">    channel-group 1 mode on</span><br><span class="line">sw102:</span><br><span class="line">int range gi 1&#x2F;2-3</span><br><span class="line">    channel-group 2 mode active</span><br><span class="line">sw110:</span><br><span class="line">int range gi 1&#x2F;2-3</span><br><span class="line">    channel-group 2 mode active</span><br><span class="line">int port-channel 1</span><br><span class="line">    shutdown</span><br><span class="line">    no shutdown             &#x2F;&#x2F; po1是静态lag，对端修改配置后，本地down&#x2F;up使其获取最新状态</span><br></pre></td></tr></table></figure>配置完成之后，检查pc端口状态, pc全部都是<code>SU</code>状态，物理成员端口全部都是<code>P</code>状态，字母含义在show中有说明。</li></ol><p>sw101 pc端口状态</p><p>sw102 pc端口状态</p><p>三角拓扑检查两台设备即可确认所有pc端口状态</p><ol start="2"><li>配置VTP<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sw101:</span><br><span class="line">vtp domain CCIE</span><br><span class="line">vtp version 3</span><br><span class="line">vtp password cc1E@fab hidden</span><br><span class="line">vtp mode server MST</span><br><span class="line">vtp primary mst force           &#x2F;&#x2F; 特权模式下强制指定mst primary server, 需要输密码</span><br><span class="line"></span><br><span class="line">sw102&#x2F;sw110:</span><br><span class="line">vtp domain CCIE</span><br><span class="line">vtp version 3</span><br><span class="line">vtp password cc1E@fab hidden</span><br><span class="line">vtp mode client MST                 &#x2F;&#x2F; 注意sw102和sw110的vtp工作在client模式 </span><br></pre></td></tr></table></figure>配置完成之后检查vtp状态：</li></ol><p>sw101的vtp状态如下：</p><p>密码是hidden所以看不到明文：</p><p>sw102的vtp状态如下：</p><ol start="3"><li>配置mst<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sw101： </span><br><span class="line">spanning-tree mode mst              指定spanning tree模式为mst</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line">    name CCIE</span><br><span class="line">    revision 1</span><br><span class="line">    instance 1 vlan 1001-2000</span><br><span class="line">    instance 2 vlan 2001-4094       &#x2F;&#x2F; mst的具体配置只需要在sw101上配置，之后会通过vtp同步给sw102和sw110</span><br><span class="line">spanning-tree mst 0-1 root primary      &#x2F;&#x2F; 指定sw101是instance 0-1的根</span><br><span class="line"></span><br><span class="line">sw102：</span><br><span class="line">spanning-tree mode mst              </span><br><span class="line">spanning-tree mst 2 root primary        &#x2F;&#x2F; 指定sw102是instance 2的根</span><br><span class="line"></span><br><span class="line">sw103:</span><br><span class="line">spaaning-tree mode mst</span><br></pre></td></tr></table></figure>配置完成之后检查mst状态，sw101作为instance 0-1根桥，sw102作为instance 2的根桥<br>sw101 spt状态</li></ol><p>sw102 spt状态</p><p>tips: sw102和sw110的VTP配置相同，spt配置基本相同，只是sw102多一个instance 2的根桥配置。复制粘贴配置即可。</p><p>后面的blog会按顺序逐题进行分析。</p>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/CCIE/">CCIE</category>
      
      
      <comments>https://rancho333.github.io/2025/06/19/lab%E8%80%83%E8%AF%95%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E5%8F%8A%E8%80%83%E9%A2%98%E5%88%86%E6%9E%901.2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>onie编译简述</title>
      <link>https://rancho333.github.io/2024/01/10/onie%E7%BC%96%E8%AF%91%E7%AE%80%E8%BF%B0/</link>
      <guid>https://rancho333.github.io/2024/01/10/onie%E7%BC%96%E8%AF%91%E7%AE%80%E8%BF%B0/</guid>
      <pubDate>Wed, 10 Jan 2024 16:16:15 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h1&gt;&lt;p&gt;简单记录下基于&lt;a href=&quot;https://github.com/CumulusNetworks/DUE/tree/master&quot;&gt;DUE&lt;/a&gt;环境编译onie镜像的过程。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>简单记录下基于<a href="https://github.com/CumulusNetworks/DUE/tree/master">DUE</a>环境编译onie镜像的过程。</p><span id="more"></span><h1 id="编译步骤"><a href="#编译步骤" class="headerlink" title="编译步骤"></a>编译步骤</h1><ol><li>下载DUE代码，构建编译环境<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;CumulusNetworks&#x2F;DUE.git    &#x2F;&#x2F; 下载DUE代码  </span><br></pre></td></tr></table></figure></li></ol><p>执行<code>./due -c --help</code> 会显示当前可以自动构建的编译环境.<br><img src="https://rancho333.github.io/pictures/due_create_help.png"></p><p>根据自己onie的源码选择对应的docker进行构建，这里选择debian10</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;due  --create  --platform  linux&#x2F;amd64    --name  onie-build-debian-10     --prompt  ONIE-10       --tag  onie-10                  --use-template  onie              --from  debian:10</span><br></pre></td></tr></table></figure><p>等待完成构建之后使用<code>docker images | grep onie</code>检查一下。</p><ol start="2"><li><p>下载onie源码</p></li><li><p>进入编译环境进行编译</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;due -r --home-dir &#x2F;projects&#x2F;erzhu&#x2F;build&#x2F;rancho&#x2F;              &#x2F;&#x2F; 在DUE根目录下执行, 使用 --home-dir 修改mount路径，默认是&#x2F;home&#x2F;rancho，保证onie源码mount进去就行</span><br></pre></td></tr></table></figure><p>进入onie的<code>build-config</code>目录，执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j8 MACHINEROOT&#x3D;..&#x2F;machine&#x2F;celestica&#x2F; MACHINE&#x3D;cel_ds2000 all            &#x2F;&#x2F; 根据vender和hwsku填即可</span><br></pre></td></tr></table></figure><p>当前代码使能了secure boot, 编译过程中需要输入密码(123456).</p></li></ol><p>编译完成之后，生成的iso镜像在<code>build/images</code>, 使用dd制作启动盘即可。</p>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/onie/">onie</category>
      
      
      <comments>https://rancho333.github.io/2024/01/10/onie%E7%BC%96%E8%AF%91%E7%AE%80%E8%BF%B0/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>SONiC中STP使用简述</title>
      <link>https://rancho333.github.io/2023/12/14/SONiC%E4%B8%ADSTP%E4%BD%BF%E7%94%A8%E7%AE%80%E8%BF%B0/</link>
      <guid>https://rancho333.github.io/2023/12/14/SONiC%E4%B8%ADSTP%E4%BD%BF%E7%94%A8%E7%AE%80%E8%BF%B0/</guid>
      <pubDate>Thu, 14 Dec 2023 14:46:41 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h1&gt;&lt;p&gt;SONiC社区当前不支持STP feature，虽然Broadcom已经提交了 &lt;a href=&quot;https://github.com/sonic-net/sonic-buildimage/pull/3463&quot;&gt;PR&lt;/a&gt;, 但是一直没有merge, 并且长时间没有维护。基于github上的开源&lt;a href=&quot;https://github.com/mstpd/mstpd&quot;&gt;MSTPD&lt;/a&gt;项目，将其porting到sonic中，完善SONiC的L2 features. 本文简述porting过程中的关键节点。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>SONiC社区当前不支持STP feature，虽然Broadcom已经提交了 <a href="https://github.com/sonic-net/sonic-buildimage/pull/3463">PR</a>, 但是一直没有merge, 并且长时间没有维护。基于github上的开源<a href="https://github.com/mstpd/mstpd">MSTPD</a>项目，将其porting到sonic中，完善SONiC的L2 features. 本文简述porting过程中的关键节点。</p><span id="more"></span><p>需要了解一些STP的背景知识，可以参考下面链接</p><ul><li><a href="https://rancho333.github.io/2022/07/07/STP802-1d%E7%AE%80%E8%BF%B0/">STP802.1d简述</a></li><li><a href="https://rancho333.github.io/2022/07/07/RSTP802-1w%E7%AE%80%E8%BF%B0/">RSTP802.1w简述</a></li><li><a href="https://rancho333.github.io/2022/07/07/mstp802-1s%E7%AE%80%E8%BF%B0/">mstp802.1s简述</a></li></ul>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/STP/">STP</category>
      
      
      <comments>https://rancho333.github.io/2023/12/14/SONiC%E4%B8%ADSTP%E4%BD%BF%E7%94%A8%E7%AE%80%E8%BF%B0/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>开机启动WSL并SSH登陆</title>
      <link>https://rancho333.github.io/2023/12/14/%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8WSL%E5%B9%B6SSH%E7%99%BB%E9%99%86/</link>
      <guid>https://rancho333.github.io/2023/12/14/%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8WSL%E5%B9%B6SSH%E7%99%BB%E9%99%86/</guid>
      <pubDate>Thu, 14 Dec 2023 14:25:05 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;背景说明&quot;&gt;&lt;a href=&quot;#背景说明&quot; class=&quot;headerlink&quot; title=&quot;背景说明&quot;&gt;&lt;/a&gt;背景说明&lt;/h1&gt;&lt;p&gt;windows的WSL功能让ubuntu作为windows的子系统，这种双系统对linux开发非常友好。一般使用远程工具如Xshell登陆Linux，对windows和WSL做一些配置，实现开启windows之后：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自动启动WSL&lt;/li&gt;
&lt;li&gt;WSL中开启sshd服务&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h1><p>windows的WSL功能让ubuntu作为windows的子系统，这种双系统对linux开发非常友好。一般使用远程工具如Xshell登陆Linux，对windows和WSL做一些配置，实现开启windows之后：</p><ul><li>自动启动WSL</li><li>WSL中开启sshd服务</li></ul><span id="more"></span><h1 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h1><ol><li>创建开机启动脚本，名称为<code>linux-start-ssh.vbs</code>, 里面的内容为：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set ws &#x3D; WScript.CreateObject(&quot;WScript.Shell&quot;)        &#39; 创建windows shell对象</span><br><span class="line">ws.run &quot;wsl -d ubuntu -u root &#x2F;etc&#x2F;init.wsl&quot;          &#39; 在shell中启动wsl，wsl启动加载 init.wsl脚本</span><br></pre></td></tr></table></figure></li></ol><p><code>init.wsl</code>脚本的内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;sh</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;ssh start           # 在wsl中启动sshd服务，这样wsl启动时就会自动开机sshd</span><br></pre></td></tr></table></figure><ol start="2"><li><p>将<code>linux-start-ssh.vbs</code>脚本加入到开机启动项中，直接将该文件拷贝到<code>C:\Users\Rancho\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code>路径下即可</p></li><li><p>在task manager中确认enable服务，设置好后状态如下图：<br><img src="https://rancho333.github.io/pictures/wsl_init_script.png"></p></li></ol><p>windows启动后自动运行<code>linux-start-ssh.vbs</code>, wsl启动后自动运行<code>init.wsl</code>.</p><ol start="4"><li>使用<code>ssh rancho@localhost</code>即可在windows上ssh登陆wsl</li></ol>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/WSL/">WSL</category>
      
      
      <comments>https://rancho333.github.io/2023/12/14/%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8WSL%E5%B9%B6SSH%E7%99%BB%E9%99%86/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Basic-L2-L3-test-for-CLS_VS_SONIC</title>
      <link>https://rancho333.github.io/2023/09/07/Basic-L2-L3-test-for-CLS-VS-SONIC/</link>
      <guid>https://rancho333.github.io/2023/09/07/Basic-L2-L3-test-for-CLS-VS-SONIC/</guid>
      <pubDate>Thu, 07 Sep 2023 10:11:13 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Environment-setup&quot;&gt;&lt;a href=&quot;#Environment-setup&quot; class=&quot;headerlink&quot; title=&quot;Environment setup&quot;&gt;&lt;/a&gt;Environment setup&lt;/h1&gt;&lt;p&gt;Firstly, we setup the test environment like below picture.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://rancho333.github.io/pictures/vs-sonic-environment.png&quot;&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Environment-setup"><a href="#Environment-setup" class="headerlink" title="Environment setup"></a>Environment setup</h1><p>Firstly, we setup the test environment like below picture.</p><p><img src="https://rancho333.github.io/pictures/vs-sonic-environment.png"></p><span id="more"></span><p>vpc1 and vpc2 perform L2 basic test in vlan100. q2a-1 and q2a-2 establish eBGP neighbors to perform l3 basic test, so that vpc1,vpc2 and vpc3 can communicate.</p><h1 id="L2-basic-test"><a href="#L2-basic-test" class="headerlink" title="L2 basic test"></a>L2 basic test</h1><p>We create vlan100 and create SVI as vlan100 gateway. Eth1 and Eth2 are the vlan100 member ports. Please pay attention to the mapping relationship between the port name of eveng and the port name of sonic.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">q2a-1:</span><br><span class="line">config vlan add 100                              &#x2F;&#x2F; create vlan100</span><br><span class="line">config vlan member add 100 Ethernet4 -u          &#x2F;&#x2F; add vlan member, SONiC Ethernet4 mapping eveng Ethernet1</span><br><span class="line">config vlan member add 100 Ethernet8 -u          &#x2F;&#x2F; SONiC Ethernet8 mapping eveng Ethernet2</span><br><span class="line">config interface ip add Vlan100 192.168.1.1&#x2F;24   &#x2F;&#x2F; create SVI</span><br></pre></td></tr></table></figure><p>After vlan configuration done, check the vlan state like below picture.<br><img src="https://rancho333.github.io/pictures/vs-sonic-vlan.png"></p><p>Config the vpc1 and vpc2 like below picture.<br><img src="https://rancho333.github.io/pictures/vs-sonic-vlan-vpc.png"></p><p>Make sure that vpc1 can ping the gateway and vpc2. Same as vpc2.<br><img src="https://rancho333.github.io/pictures/vs-sonic-vpc1-vpc2.png"></p><p>Check the mac address table and arp table on q2a-1 respectively.<br><img src="https://rancho333.github.io/pictures/vs-sonic-mac-arp.png"></p><h1 id="L3-basic-test"><a href="#L3-basic-test" class="headerlink" title="L3 basic test"></a>L3 basic test</h1><p>We create L3 interface on q2a-1 and q2a-2 respectively like below picture.<br><img src="https://rancho333.github.io/pictures/vs-sonic-if-ip.png"></p><p>After that, We can configure eBGP to propagate routes. For q2a-1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router bgp 100                          &#x2F;&#x2F; Asign ASN 100 to q2a-1</span><br><span class="line"> neighbor 192.168.2.2 remote-as 200     &#x2F;&#x2F; Specify neighbor ip and ASN</span><br><span class="line"></span><br><span class="line">address-family ipv4 unicast</span><br><span class="line">  redistribute connected                &#x2F;&#x2F; redistribute connected routes into BGP (subnet of 192.168.1.0)</span><br></pre></td></tr></table></figure><p>For q2a-2, same as q2a-1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router bgp 200</span><br><span class="line"> neighbor 192.168.2.1 remote-as 100</span><br><span class="line"></span><br><span class="line">address-family ipv4 unicast</span><br><span class="line">  redistribute connected</span><br></pre></td></tr></table></figure><p>Make sure q2a-1 and q2a-2 can establish BGP neighbor and send routes to each other.<br><img src="https://rancho333.github.io/pictures/vs-sonic-bgp-neighbor.png"></p><p>Check q2a-1 can learn 192.168.3.0 from BGP and q2a-2 can learn 192.168.1.0 form BGP.<br><img src="https://rancho333.github.io/pictures/vs-sonic-bgp-routes.png"></p><p>Finally, check vpc1-vpc3 and vpc2-vpc3 can communicate with each other.<br><img src="https://rancho333.github.io/pictures/vs-sonic-ping-finally.png"></p><p>WindowsSensor.MaverickGyr.exe /install /quiet /norestart CID=CDB05CA08ADD4558958FC3FEF8D222AE-04</p>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/SONiC/">SONiC</category>
      
      
      <comments>https://rancho333.github.io/2023/09/07/Basic-L2-L3-test-for-CLS-VS-SONIC/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Questone2A_snake_traffic_test</title>
      <link>https://rancho333.github.io/2023/04/03/Questone2A_snake_traffic_test/</link>
      <guid>https://rancho333.github.io/2023/04/03/Questone2A_snake_traffic_test/</guid>
      <pubDate>Mon, 03 Apr 2023 09:00:38 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;environment-description&quot;&gt;&lt;a href=&quot;#environment-description&quot; class=&quot;headerlink&quot; title=&quot;environment description&quot;&gt;&lt;/a&gt;environment description&lt;/h1&gt;&lt;p&gt;The experimental topology is shown in the figure:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://rancho333.github.io/pictures/questone2a_100G_snake_traffic_topology.png&quot;&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="environment-description"><a href="#environment-description" class="headerlink" title="environment description"></a>environment description</h1><p>The experimental topology is shown in the figure:</p><p><img src="https://rancho333.github.io/pictures/questone2a_100G_snake_traffic_topology.png"></p><span id="more"></span><p>After the line is connected, do some configuration on ixia to make the port up. On sonic, link training and auto negotiation are disabled by default, and FEC is enabled. Set the corresponding interface on ixia to match it.</p><p>Make sure the port is up:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@sonic:&#x2F;home&#x2F;admin# show interfaces status Ethernet49-56</span><br><span class="line">  Interface        Lanes    Speed    MTU    FEC    Alias    Vlan    Oper    Admin             Type    Asym PFC</span><br><span class="line">-----------  -----------  -------  -----  -----  -------  ------  ------  -------  ---------------  ----------</span><br><span class="line"> Ethernet49  41,42,43,44     100G   9100     rs   100GE1  routed      up       up  QSFP28 or later         N&#x2F;A</span><br><span class="line"> Ethernet50  45,46,47,48     100G   9100     rs   100GE2  routed      up       up  QSFP28 or later         N&#x2F;A</span><br><span class="line"> Ethernet51  73,74,75,76     100G   9100     rs   100GE3  routed      up       up          Unknown         N&#x2F;A</span><br><span class="line"> Ethernet52  77,78,79,80     100G   9100     rs   100GE4  routed      up       up  QSFP28 or later         N&#x2F;A</span><br><span class="line"> Ethernet53      1,2,3,4     100G   9100     rs   100GE5  routed      up       up  QSFP28 or later         N&#x2F;A</span><br><span class="line"> Ethernet54  21,22,23,24     100G   9100     rs   100GE6  routed      up       up  QSFP28 or later         N&#x2F;A</span><br><span class="line"> Ethernet55     5,6,7,8,     100G   9100     rs   100GE7  routed      up       up  QSFP28 or later         N&#x2F;A</span><br><span class="line"> Ethernet56  25,26,27,28     100G   9100     rs   100GE8  routed      up       up  QSFP28 or later         N&#x2F;A</span><br></pre></td></tr></table></figure><h1 id="snake-traffic-test-for-100G"><a href="#snake-traffic-test-for-100G" class="headerlink" title="snake traffic test for 100G"></a>snake traffic test for 100G</h1><p>The ixia eth7 port sends out Layer 2 packets, the two sonic ports are in the same vlan, and the ixia eth8 port receives packets for statistics to check whether packets are lost. Similarly, eth8 sends packets, and eth7 receives packets. In this way, the bidirectional Layer 2 wire-speed streaming test is realized. The detailed steps are as follows:</p><p>sonic configuration:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drivshell&gt;vlan clear</span><br><span class="line">vlan clear</span><br><span class="line">drivshell&gt;vlan remove 1 pbm&#x3D;ce</span><br><span class="line">vlan remove 1 pbm&#x3D;ce</span><br><span class="line">drivshell&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">drivshell&gt;vlan create 100 pbm&#x3D;ce1,ce2 ubm&#x3D;ce1,ce2; pvlan set ce1,ce2 100</span><br><span class="line">vlan create 101 pbm&#x3D;ce3,ce4 ubm&#x3D;ce3,ce4; pvlan set ce3,ce4 101</span><br><span class="line">vlan create 102 pbm&#x3D;ce5,ce7 ubm&#x3D;ce5,ce7; pvlan set ce5,ce7 102</span><br><span class="line">vlan create 100 pbm&#x3D;ce1,ce2 ubm&#x3D;ce1,ce2; pvlan set ce1,ce2 100</span><br><span class="line">vlan create 102 pbm&#x3D;ce5,ce7 ubm&#x3D;ce5,ce7; pvlan set ce5,ce7 102</span><br><span class="line">vlan create 103 pbm&#x3D;ce0,ce6 ubm&#x3D;ce0,ce6; pvlan set ce0,ce6 103</span><br><span class="line">drivshell&gt;vlan create 101 pbm&#x3D;ce3,ce4 ubm&#x3D;ce3,ce4; pvlan set ce3,ce4 101</span><br><span class="line">drivshell&gt;vlan create 102 pbm&#x3D;ce5,ce7 ubm&#x3D;ce5,ce7; pvlan set ce5,ce7 102</span><br><span class="line">drivshell&gt;vlan create 103 pbm&#x3D;ce0,ce6 ubm&#x3D;ce0,ce6; pvlan set ce0,ce6 103</span><br><span class="line">drivshell&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">drivshell&gt;vlan show</span><br><span class="line">vlan show</span><br><span class="line">vlan 1ports none (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000), untagged none (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000) MCAST_FLOOD_UNKNOWN</span><br><span class="line">vlan 100ports ce1-ce2 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000800000400000000), untagged ce1-ce2 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000800000400000000) MCAST_FLOOD_UNKNOWN</span><br><span class="line">vlan 101ports ce3-ce4 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000002), untagged ce3-ce4 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000002) MCAST_FLOOD_UNKNOWN</span><br><span class="line">vlan 102ports ce5,ce7 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018000), untagged ce5,ce7 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018000) MCAST_FLOOD_UNKNOWN</span><br><span class="line">vlan 103ports ce0,ce6 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000004), untagged ce0,ce6 (0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000004) MCAST_FLOOD_UNKNOWN</span><br><span class="line">drivshell&gt;</span><br></pre></td></tr></table></figure><p>Then create two Layer 2 stream:<br><img src="https://rancho333.github.io/pictures/questone2a_100G_snake_traffic_traffic.png"></p><p>The picture shows eth7 sending and eth8 receiving and checking. Similarly, reverse flow is created to realize bidirectional streaming test. Note that it is better to modify the source and destination MAC addresses of Layer 2 packets.</p><p>Final streaming test:<br><img src="https://rancho333.github.io/pictures/questone2a_snake_traffic_100G_result.png"></p><p>As you can see， no packet loss.</p><p>Check the packets counters in Bcmsh.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">drivshell&gt;show c CLMIB_RPOK.ce</span><br><span class="line">show c CLMIB_RPOK.ce</span><br><span class="line">CLMIB_RPOK.ce0    :     23,803,850,505    +13       1&#x2F;s</span><br><span class="line">CLMIB_RPOK.ce1    :     30,512,888,521    +13       1&#x2F;s</span><br><span class="line">CLMIB_RPOK.ce2    :     23,803,849,548     +8</span><br><span class="line">CLMIB_RPOK.ce3    :     30,512,889,476     +8</span><br><span class="line">CLMIB_RPOK.ce4    :     23,803,848,543    +11       1&#x2F;s</span><br><span class="line">CLMIB_RPOK.ce5    :     30,512,890,437    +11       1&#x2F;s</span><br><span class="line">drivshell&gt;show c CLMIB_RFCS</span><br><span class="line">show c CLMIB_RFCS</span><br><span class="line">drivshell&gt;</span><br></pre></td></tr></table></figure><h1 id="snake-traffic-test-for-25G"><a href="#snake-traffic-test-for-25G" class="headerlink" title="snake traffic test for 25G"></a>snake traffic test for 25G</h1><p>Ixia don’t have 25G ports, so i use 100G of ixia connet to 100G port of Questone2A and just send 25% line rate to test 25G port of Questone2A. The test environment tpology is show as below picture.<br><img src="https://rancho333.github.io/pictures/questone2a_snake_traffic_25G_topology.png"></p><p>sonic configuration:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">drivshell&gt;vlan clear</span><br><span class="line">vlan clear</span><br><span class="line">drivshell&gt;vlan remove 1 pbm&#x3D;ce</span><br><span class="line">vlan remove 1 pbm&#x3D;ce</span><br><span class="line">drivshell&gt;vlan remove 1 pbm&#x3D;xe</span><br><span class="line">vlan remove 1 pbm&#x3D;xe</span><br><span class="line"></span><br><span class="line">drivshell&gt;vlan create 100 pbm&#x3D;xe1,xe2 ubm&#x3D;xe1,xe2; pvlan set xe1,xe2 100</span><br><span class="line">23,xe24; pvlan set xe23,xe24 111</span><br><span class="line">vlan create 112 pbm&#x3D;xe25,xe26 ubm&#x3D;xe25,xe26; pvlan set xe25,xe26 112</span><br><span class="line">vlan create 113 pbm&#x3D;xe27,xe28 ubm&#x3D;xe27,xe28; pvlan set xe27,xe28 113</span><br><span class="line">vlan create 114 pbm&#x3D;xe29,xe30 ubm&#x3D;xe29,xe30; pvlan set xe29,xe30 114</span><br><span class="line">pbm&#x3D;xe31,xe32 ubm&#x3D;xe31,xe32; pvlan set xe31,xe32 115</span><br><span class="line">vlan create 116 pbm&#x3D;xe33,xe34 ubm&#x3D;xe33,xe34; pvlan set xe33,xe34 116</span><br><span class="line">vlan create 117 pbm&#x3D;xe35,xe36 ubm&#x3D;xe35,xe36; pvlan set xe35,xe36 117</span><br><span class="line">vlan create 118 pbm&#x3D;xe37,xe38 ubm&#x3D;xe37,xe38; pvlan set xe37,xe38 vlan create 101 pbm&#x3D;xe3,xe4 ubm&#x3D;xe3,xe4; pvlan set xe3,xe4 101</span><br><span class="line">vlan create 102 pbm&#x3D;xe5,xe6 ubm&#x3D;xe5,xe6; pvlan set xe5,xe6 102</span><br><span class="line">vlan create 100 pbm&#x3D;xe1,xe2 ubm&#x3D;xe1,xe2; pvlan set xe1,xe2 100</span><br><span class="line">vlan create 101 pbm&#x3D;xe3,xe4 ubm&#x3D;xe3,xe4; pvlan set xe3,xe4 101</span><br><span class="line">vlan create 102 pbm&#x3D;xe5,xe6 ubm&#x3D;xe5,xe6; pvlan set xe5,xe6 102</span><br><span class="line">vlan create 103 pbm&#x3D;xe7,xe8 ubm&#x3D;xe7,xe8; pvlan set xe7,xe8 103</span><br><span class="line">drivshell&gt;vlan create 101 pbm&#x3D;xe3,xevlan create 104 pbm&#x3D;xe9,xe10 ubm&#x3D;xe9,xe10; pvlan set xe9,xe10 104</span><br><span class="line">4 ubm&#x3D;xe3,xe4; pvlan set xe3,xe4 101</span><br><span class="line">vlan create 104 pbm&#x3D;xe9,xe10 ubm&#x3D;xe9,xe10; pvlan set xe9,xe10 104</span><br><span class="line">vlan create 105 pbm&#x3D;xe11,xe12 ubm&#x3D;xe11,xe12; pvlan set xe11,xe12 105</span><br><span class="line">vlan create 106 pbm&#x3D;xe13,xe14 ubm&#x3D;xe13,xe14; pvlan set xe13,xe14 106</span><br><span class="line">vlan create 105 pbm&#x3D;xe11,xe12 ubm&#x3D;xe11,xe12; pvlan set xe11,xe12 105</span><br><span class="line">drivshell&gt;vlan create 102vlan create 107 pbm&#x3D;xe15,xe16 ubm&#x3D;xe15,xe16; pvlan set xe15,xe16 107</span><br><span class="line"> pbm&#x3D;xe5,xe6 ubm&#x3D;xe5,xe6; pvlan set vlan create 108 pbm&#x3D;xe17,xe18 ubm&#x3D;xe17,xe18; pvlan set xe17,xe18 108</span><br><span class="line">vlan create 109 pbm&#x3D;xe19,xe20 ubm&#x3D;xe19,xe20; pvlan set xe19,xe20 109</span><br><span class="line">xe5,xe6 102</span><br><span class="line">vlan create 108 pbm&#x3D;xe17,xe18 ubm&#x3D;xe17,xe18; pvlan set xe17,xe18 108</span><br><span class="line">drivshell&gt;vlan create 103 pbm&#x3D;xe7,xe8 ubm&#x3D;xe7,xe8; pvlan set xe7,xe8 103</span><br><span class="line">vlan create 109 pbm&#x3D;xe19,xe20 ubm&#x3D;xe19,xe20; pvlan set xe19,xe20 109</span><br><span class="line">vlan create 110 pbm&#x3D;xe21,xe22 ubm&#x3D;xe21,xe22; pvlan set xe21,xe22 110</span><br><span class="line">vlan create 111 pbm&#x3D;xe23,xe24 ubm&#x3D;xe23,xe24; pvlan set xe23,xe24 111</span><br><span class="line">vlan create 110 pbm&#x3D;xe21,xe22 ubm&#x3D;xe21,xe22; pvlan set xe21,xe22 110</span><br><span class="line">vlan create 111 pbm&#x3D;xe23,xe24 ubm&#x3D;xe23,xe24; pvlan set xe23,xe24 111</span><br><span class="line">vlan create 112 pbm&#x3D;xe25,xe26 ubm&#x3D;xe25,xe26; pvlan set xe25,xe26 112</span><br><span class="line">vlan create 113 pbm&#x3D;xe27,xe28 ubm&#x3D;xe27,xe28; pvlan set xe27,xe28 113</span><br><span class="line">drivshell&gt;vlan create 104 pbm&#x3D;xe9,xe10 ubm&#x3D;xe9,xe10; pvlan set xe9,xe10 104</span><br><span class="line">vlan create 112 pbm&#x3D;xe25,xe26 ubm&#x3D;xe25,xe26; pvlan set xe25,xe26 112</span><br><span class="line">drivshell&gt;vlan create 105 pbm&#x3D;xe11,xe12 ubm&#x3D;xe11,xe12; pvlan set xe11,xe12 105</span><br><span class="line">vlan create 113 pbm&#x3D;xe27,xe28 ubm&#x3D;xe27,xe28; pvlan set xe27,xe28 113</span><br><span class="line">vlan create 114 pbm&#x3D;xe29,xe30 ubm&#x3D;xe29,xe30; pvlan set xe29,xe30 114</span><br><span class="line">vlan create 115 pbm&#x3D;xe31,xe32 ubm&#x3D;xe31,xe32; pvlan set xe31,xe32 115</span><br><span class="line">vlan create 114 pbm&#x3D;xe29,xe30 ubm&#x3D;xe29,xe30; pvlan set xe29,xe30 114</span><br><span class="line">vlan create 115 pbm&#x3D;xe31,xe32 ubm&#x3D;xe31,xe32; pvlan set xe31,xe32 115</span><br><span class="line">vlan create 116 pbm&#x3D;xe33,xe34 ubm&#x3D;xe33,xe34; pvlan set xe33,xe34 116</span><br><span class="line">vlan create 117 pbm&#x3D;xe35,xe36 ubm&#x3D;xe35,xe36; pvlan set xe35,xe36 117</span><br><span class="line">vlan create 116 pbm&#x3D;xe33,xe34 ubm&#x3D;xe33,xe34; pvlan set xe33,xe34 116</span><br><span class="line">vlan create 117 pbm&#x3D;xe35,xe36 ubm&#x3D;xe35,xe36; pvlan set xe35,xe36 117</span><br><span class="line">vlan create 118 pbm&#x3D;xe37,xe38 ubm&#x3D;xe37,xe38; pvlan set xe37,xe38 118</span><br><span class="line">vlan create 119 pbm&#x3D;xe39,xe40 ubm&#x3D;xe39,xe40; pvlan set xe39,xe40 119</span><br><span class="line">vlan create 118 pbm&#x3D;xe37,xe38 ubm&#x3D;xe37,xe38; pvlan set xe37,xe38 118</span><br><span class="line">drivshell&gt;vlan create 106 pbm&#x3D;xe13,xe14 ubm&#x3D;xe13,xe14; pvlan set xe13,xe14 106</span><br><span class="line">vlan create 119 pbm&#x3D;xe39,xe40 ubm&#x3D;xe39,xe40; pvlan set xe39,xe40 119</span><br><span class="line">vlan create 120 pbm&#x3D;xe41,xe42 ubm&#x3D;xe41,xe42; pvlan set xe41,xe42 120</span><br><span class="line">vlan create 121 pbm&#x3D;xe43,xe44 ubm&#x3D;xe43,xe44; pvlan set xe43,xe44 121</span><br><span class="line">vlan create 120 pbm&#x3D;xe41,xe42 ubm&#x3D;xe41,xe42; pvlan set xe41,xe42 120</span><br><span class="line">drivshell&gt;vlan vlan create 122 pbm&#x3D;xe45,xe46 ubm&#x3D;xe45,xe46; pvlan set xe45,xe46 122</span><br><span class="line">create 107 pbm&#x3D;xe15,xe16 ubm&#x3D;xe15,xe16; pvlan set xe15,xe16 107</span><br><span class="line">drivshell&gt;vlan create 108 pbm&#x3D;xe17,xe18 ubm&#x3D;xe17,xe18; pvlan set xe17,xe18 108</span><br><span class="line">drivshell&gt;vlan create 109 pbm&#x3D;xe19,xe20 ubm&#x3D;xe19,xe20; pvlan set xe19,xe20 109</span><br><span class="line">vlan create 122 pbm&#x3D;xe45,xe46 ubm&#x3D;xe45,xe46; pvlan set xe45,xe46 122</span><br><span class="line">vlan create 123 pbm&#x3D;ce6,xe0 ubm&#x3D;ce6,xe0; pvlan set ce6,xe0 123</span><br><span class="line">vlan create 124 pbm&#x3D;ce7,xe47 ubm&#x3D;ce7,xe47; pvlan set ce7,xe47 124</span><br><span class="line">vlan create 123 pbm&#x3D;ce6,xe0 ubm&#x3D;ce6,xe0; pvlan set ce6,xe0 123</span><br><span class="line">drivshell&gt;vlan create 110 pbm&#x3D;xe21,xe22 ubm&#x3D;xe21,xe22; pvlan set xe21,xe22 110</span><br><span class="line">drivshell&gt;vlan create 111 pbm&#x3D;xe23,xe24 ubm&#x3D;xe23,xe24; pvlan set xe23,xe24 111</span><br><span class="line">drivshell&gt;vlan create 112 pbm&#x3D;xe25,xe26 ubm&#x3D;xe25,xe26; pvlan set xe25,xe26 112</span><br><span class="line">drivshell&gt;vlan create 113 pbm&#x3D;xe27,xe28 ubm&#x3D;xe27,xe28; pvlan set xe27,xe28 113</span><br><span class="line">drivshell&gt;vlan create 114 pbm&#x3D;xe29,xe30 ubm&#x3D;xe29,xe30; pvlan set xe29,xe30 114</span><br><span class="line">drivshell&gt;vlan create 115 pbm&#x3D;xe31,xe32 ubm&#x3D;xe31,xe32; pvlan set xe31,xe32 115</span><br><span class="line">drivshell&gt;vlan create 116 pbm&#x3D;xe33,xe34 ubm&#x3D;xe33,xe34; pvlan set xe33,xe34 116</span><br><span class="line">drivshell&gt;vlan create 117 pbm&#x3D;xe35,xe36 ubm&#x3D;xe35,xe36; pvlan set xe35,xe36 117</span><br><span class="line">drivshell&gt;vlan create 118 pbm&#x3D;xe37,xe38 ubm&#x3D;xe37,xe38; pvlan set xe37,xe38 118</span><br><span class="line">drivshell&gt;vlan create 119 pbm&#x3D;xe39,xe40 ubm&#x3D;xe39,xe40; pvlan set xe39,xe40 119</span><br><span class="line">drivshell&gt;vlan create 120 pbm&#x3D;xe41,xe42 ubm&#x3D;xe41,xe42; pvlan set xe41,xe42 120</span><br><span class="line">drivshell&gt;vlan create 121 pbm&#x3D;xe43,xe44 ubm&#x3D;xe43,xe44; pvlan set xe43,xe44 121</span><br><span class="line">drivshell&gt;vlan create 122 pbm&#x3D;xe45,xe46 ubm&#x3D;xe45,xe46; pvlan set xe45,xe46 122</span><br><span class="line">drivshell&gt;vlan create 123 pbm&#x3D;ce6,xe0 ubm&#x3D;ce6,xe0; pvlan set ce6,xe0 123</span><br><span class="line">drivshell&gt;vlan create 124 pbm&#x3D;ce7,xe47 ubm&#x3D;ce7,xe47; pvlan set ce7,xe47 124</span><br><span class="line">drivshell&gt;</span><br></pre></td></tr></table></figure><p>ixia is configured as follows:<br><img src="https://rancho333.github.io/pictures/questone2a_snake_traffic_25G_ixia.png"></p><p>Finally, start the test to check the packet loss:<br><img src="https://rancho333.github.io/pictures/questone2a_snake_traffic_25G_result.png"></p><p>Check the packets counters in Bcmsh.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">drivshell&gt;show c CLMIB_TPKT.xe</span><br><span class="line">show c CLMIB_TPKT.xe</span><br><span class="line">CLMIB_TPKT.xe0    :      1,347,751,223     +6</span><br><span class="line">CLMIB_TPKT.xe1    :      1,347,716,171   +154       8&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe2    :      1,347,683,168    +12</span><br><span class="line">CLMIB_TPKT.xe3    :      1,347,660,881   +148       8&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe4    :      1,347,633,886    +18</span><br><span class="line">CLMIB_TPKT.xe5    :      1,347,611,124   +142       8&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe6    :      1,347,585,268    +24</span><br><span class="line">CLMIB_TPKT.xe7    :      1,347,562,390   +136       8&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe8    :      1,347,536,351    +30</span><br><span class="line">CLMIB_TPKT.xe9    :      1,347,513,095   +130       8&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe10     :      1,347,486,710    +38       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe11     :      1,347,463,552   +125       8&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe12     :      1,347,389,466    +45       2&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe13     :      1,347,366,188   +118       7&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe14     :      1,347,341,022    +50       2&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe15     :      1,347,317,516   +109       5&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe16     :      1,347,292,618    +57       3&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe17     :      1,347,269,117   +102       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe18     :      1,347,243,912    +64       3&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe19     :      1,347,215,748    +95       3&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe20     :      1,347,191,194    +69       3&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe21     :      1,347,166,549    +88       3&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe22     :      1,347,141,524    +78       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe23     :      1,347,116,886    +83       3&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe24     :      1,348,186,469    +83       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe25     :      1,348,161,948    +74       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe26     :      1,348,136,316    +90       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe27     :      1,348,106,807    +69       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe28     :      1,348,079,919    +95       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe29     :      1,348,048,460    +62       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe30     :      1,348,018,298   +102       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe31     :      1,347,983,062    +57       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe32     :      1,347,951,303   +107       4&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe33     :      1,347,917,231    +50       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe34     :      1,347,886,358   +116       5&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe35     :      1,347,853,385    +45       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe36     :      1,347,092,884   +121       5&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe37     :      1,347,067,278    +38       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe38     :      1,347,043,968   +127       5&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe39     :      1,347,017,351    +32       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe40     :      1,346,994,279   +135       6&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe41     :      1,346,968,532    +26       1&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe42     :      1,346,946,104   +142       6&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe43     :      1,346,917,004    +19</span><br><span class="line">CLMIB_TPKT.xe44     :      1,346,894,475   +148       7&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe45     :      1,346,866,979    +12</span><br><span class="line">CLMIB_TPKT.xe46     :      1,346,843,674   +154       7&#x2F;s</span><br><span class="line">CLMIB_TPKT.xe47     :      1,346,816,974     +6</span><br><span class="line">drivshell&gt;</span><br><span class="line">drivshell&gt;show c CLMIB_RFCS</span><br><span class="line">show c CLMIB_RFCS</span><br><span class="line">drivshell&gt;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      
      
      <comments>https://rancho333.github.io/2023/04/03/Questone2A_snake_traffic_test/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Questone2A_25G_line_rate_test</title>
      <link>https://rancho333.github.io/2023/03/27/Questone2A_25G_line_rate_test/</link>
      <guid>https://rancho333.github.io/2023/03/27/Questone2A_25G_line_rate_test/</guid>
      <pubDate>Mon, 27 Mar 2023 09:00:38 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;environment-description&quot;&gt;&lt;a href=&quot;#environment-description&quot; class=&quot;headerlink&quot; title=&quot;environment description&quot;&gt;&lt;/a&gt;environment description&lt;/h1&gt;&lt;p&gt;The experimental topology is shown in the figure:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://rancho333.github.io/pictures/questone2a_25G_topology.png&quot;&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="environment-description"><a href="#environment-description" class="headerlink" title="environment description"></a>environment description</h1><p>The experimental topology is shown in the figure:</p><p><img src="https://rancho333.github.io/pictures/questone2a_25G_topology.png"></p><span id="more"></span><p>We only need add one ixia 100G port to topology, and set the line rate of 25 percent to test Questone2A 25G ports.<br><img src="https://rancho333.github.io/pictures/questone2a_25G_ixia_topology.png"></p><p>For Questone2A, follow the below cmds to set up test enviorments.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vlan clear              </span><br><span class="line">vlan remove 1 pbm&#x3D;ce       </span><br><span class="line">vlan remove 1 pbm&#x3D;xe </span><br><span class="line"></span><br><span class="line">vlan create 103 pbm&#x3D;xe0,ce0 ubm&#x3D;xe0,ce0; pvlan set xe0,ce0 103</span><br><span class="line">vlan create 100 pbm&#x3D;xe1,xe2 ubm&#x3D;xe1,xe2; pvlan set xe1,xe2 100</span><br><span class="line">vlan create 101 pbm&#x3D;xe3,xe4 ubm&#x3D;xe3,xe4; pvlan set xe3,xe4 101</span><br><span class="line">vlan create 102 pbm&#x3D;xe5,xe6 ubm&#x3D;xe5,xe6; pvlan set xe5,xe6 102</span><br><span class="line">vlan create 104 pbm&#x3D;xe7,ce0 ubm&#x3D;xe7,ce0; pvlan set xe7,ce0 104</span><br></pre></td></tr></table></figure><p>We test three different(20,25,30) line rate speed, and expect no packets loss when line rate under 25 percent.</p><p>We use default preemphasis and differnet FEC setting to test line rate of 25G port.</p><h2 id="FEC-fc"><a href="#FEC-fc" class="headerlink" title="FEC fc"></a>FEC fc</h2><p>For fec mode of fc，ports status show as below picture.<br><img src="https://rancho333.github.io/pictures/questone2a_25g_fec_fc.png"></p><h3 id="Line-rate-20-percent"><a href="#Line-rate-20-percent" class="headerlink" title="Line rate 20 percent"></a>Line rate 20 percent</h3><p>Just set line rate 20 percent on ixia like below picture.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_20.png"></p><p>Test results show as below picture and meet expectations.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_20_result.png"></p><h3 id="Line-rate-25-percent"><a href="#Line-rate-25-percent" class="headerlink" title="Line rate 25 percent"></a>Line rate 25 percent</h3><p>Test results show as below picture and meet expectations.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_25.png"></p><h3 id="Line-rate-30-percent"><a href="#Line-rate-30-percent" class="headerlink" title="Line rate 30 percent"></a>Line rate 30 percent</h3><p>Test results show as below picture and packets loss.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_30.png"></p><h2 id="Fec-none"><a href="#Fec-none" class="headerlink" title="Fec none"></a>Fec none</h2><p>For fec mode of none, ports status show as below picture.<br><img src="https://rancho333.github.io/pictures/questone2a_25_fec_none.png"></p><h3 id="Line-rate-20-percent-1"><a href="#Line-rate-20-percent-1" class="headerlink" title="Line rate 20 percent"></a>Line rate 20 percent</h3><p>For fec mode of none, ports status show as below picture.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_20_none.png"></p><h3 id="Line-rate-25-percent-1"><a href="#Line-rate-25-percent-1" class="headerlink" title="Line rate 25 percent"></a>Line rate 25 percent</h3><p>For fec mode of none, ports status show as below picture.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_25_none.png"></p><h3 id="Line-rate-30-percent-1"><a href="#Line-rate-30-percent-1" class="headerlink" title="Line rate 30 percent"></a>Line rate 30 percent</h3><p>Test results show as below picture and packets loss.<br><img src="https://rancho333.github.io/pictures/questone2a_line_rate_30_none.png"></p>]]></content:encoded>
      
      
      
      
      <comments>https://rancho333.github.io/2023/03/27/Questone2A_25G_line_rate_test/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>vrf lite route leaking</title>
      <link>https://rancho333.github.io/2022/10/13/vrf-lite-route-leaking/</link>
      <guid>https://rancho333.github.io/2022/10/13/vrf-lite-route-leaking/</guid>
      <pubDate>Thu, 13 Oct 2022 16:07:22 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h1&gt;&lt;p&gt;之前在&lt;a href=&quot;https://rancho333.github.io/2021/10/20/vrf%E7%AE%80%E8%BF%B0%E5%8F%8A%E4%BB%BF%E7%9C%9F%E5%AE%9E%E9%AA%8C/&quot;&gt;vrf简述及仿真实验&lt;/a&gt;对vrf有了一个基本的了解，但是vrf lite route leaking实验失败了。现在补做回来。&lt;/p&gt;
&lt;p&gt;vrf之间的路由泄漏有静态配置和MP-BGP两种方式，本文只做静态配置的实验。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>之前在<a href="https://rancho333.github.io/2021/10/20/vrf%E7%AE%80%E8%BF%B0%E5%8F%8A%E4%BB%BF%E7%9C%9F%E5%AE%9E%E9%AA%8C/">vrf简述及仿真实验</a>对vrf有了一个基本的了解，但是vrf lite route leaking实验失败了。现在补做回来。</p><p>vrf之间的路由泄漏有静态配置和MP-BGP两种方式，本文只做静态配置的实验。</p><span id="more"></span><h1 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h1><p>之前的实验时是由于配置出的问题，参考cisco的<a href="https://www.cisco.com/c/en/us/support/docs/multiprotocol-label-switching-mpls/multiprotocol-label-switching-vpns-mpls-vpns/47807-routeleaking.html#diffvrfs">Route Leaking in MPLS/VPN Networks</a>, 两个vrf之间不能直接泄露路由，必须从global中转一下才行。</p><p>实验拓扑如下图所示：<br><img src="https://rancho333.github.io/pictures/vrf_leaking_topology.png"></p><p>vpc2属于vrf 2, vpc3属于vrf 3, vpc4属于global. 通过配置使三者之间可以相互通信。<br>对于vrf -&gt; global，在vrf中写到达global中prefix路由，在global中写到达vrf中prefix的路由。<br>对于vrf -&gt; vrf，在vrf中写到达另一个vrf中prefix的路由(下一跳在global中)，在global中写到达该prefix的路由，对于另一个vrf，做相同的操作。</p><p>下面开始配置。基本的ip网段配置规则按设备名称来，这里不贴出来。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">R1(config)#ip vrf 2             &#x2F;&#x2F; 创建vrf2</span><br><span class="line">R1(config)#ip vrf 3             &#x2F;&#x2F; 创建vrf3</span><br><span class="line"></span><br><span class="line">R1(config-if)#interface ethernet 0&#x2F;0</span><br><span class="line">R1(config-if)#ip vrf forwarding 2                   &#x2F;&#x2F; 将eth0加入vrf 2</span><br><span class="line">R1(config-if)#ip address 12.1.1.1 255.255.255.0</span><br><span class="line"></span><br><span class="line">R1(config-if)#interface ethernet 0&#x2F;1</span><br><span class="line">R1(config-if)#ip vrf forwarding 3                   &#x2F;&#x2F; 将eth1加入vrf 3</span><br><span class="line">R1(config-if)#ip address 13.1.1.1 255.255.255.0</span><br></pre></td></tr></table></figure><p>测试下基本的联通性：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vpc4&gt; ping 14.1.1.1 -c 1                &#x2F;&#x2F; 可以ping通自己的网关</span><br><span class="line"></span><br><span class="line">84 bytes from 14.1.1.1 icmp_seq&#x3D;1 ttl&#x3D;255 time&#x3D;0.335 ms</span><br><span class="line"></span><br><span class="line">vpc4&gt; ping 12.1.1.2 -c 1                &#x2F;&#x2F; 不能和vrf 2通信</span><br><span class="line"></span><br><span class="line">*14.1.1.1 icmp_seq&#x3D;1 ttl&#x3D;255 time&#x3D;0.497 ms (ICMP type:3, code:1, Destination host unreachable)</span><br><span class="line"></span><br><span class="line">vpc4&gt; ping 13.1.1.3 -c 1                &#x2F;&#x2F; 不能和vrf 3通信</span><br><span class="line"></span><br><span class="line">*14.1.1.1 icmp_seq&#x3D;1 ttl&#x3D;255 time&#x3D;0.492 ms (ICMP type:3, code:1, Destination host unreachable)</span><br></pre></td></tr></table></figure><p>符合预期。</p><p>对于vrf 2与global之间的通信：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">R1(config)#ip route vrf 2 14.1.1.0 255.255.255.0 14.1.1.4 global            &#x2F;&#x2F; 在vrf 2中添加global中prefix的路由，global关键词表明：如果在vrf 2中收到prefix是14.1.1.0&#x2F;24的报文时，到global路由表中找路由出去，由于14.1.1.0&#x2F;24是global中的直连网段，所以报文可以转发</span><br><span class="line">R1(config)#ip route 12.1.1.0 255.255.255.0 ethernet 0&#x2F;0             &#x2F;&#x2F; global中添加到vrf 2中prefix的路由，注意下一跳需要指定是物理接口，如果指定ip的话，不能正常路由</span><br><span class="line"></span><br><span class="line">vpc4&gt; ping 12.1.1.2 -c 1                &#x2F;&#x2F; vrf 2与global之间三层可达</span><br><span class="line"></span><br><span class="line">84 bytes from 12.1.1.2 icmp_seq&#x3D;1 ttl&#x3D;63 time&#x3D;1.219 ms</span><br></pre></td></tr></table></figure><p>vrf 3与global之间的通信类似配置。<br>对于vrf 2与vrf 3之间的通信：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">R1(config)#ip route vrf 2 13.1.1.0 255.255.255.0 13.1.1.3 global            &#x2F;&#x2F; 在vrf 2中添加vrf 3中prefix的路由，下一跳去global中找</span><br><span class="line">R1(config)#ip route 13.1.1.0 255.255.255.0 ethernet 0&#x2F;1                     &#x2F;&#x2F; global中没有到vrf 3的路由，所以需要在global中添加到vrf 3中prefix的路由</span><br><span class="line"></span><br><span class="line">R1(config)#ip route vrf 3 12.1.1.0 255.255.255.0 12.1.1.2 global            &#x2F;&#x2F; 同理在vrf 3中添加到vrf 2中prefix的路由</span><br><span class="line">R1(config)#ip route 12.1.1.0 255.255.255.0 ethernet 0&#x2F;0        </span><br><span class="line"></span><br><span class="line">vpc2&gt; ping 13.1.1.3 -c 1                    &#x2F;&#x2F; vrf 2与vrf 3之间三层可达</span><br><span class="line"></span><br><span class="line">84 bytes from 13.1.1.3 icmp_seq&#x3D;1 ttl&#x3D;63 time&#x3D;3.980 ms</span><br></pre></td></tr></table></figure><p>由于global中已经有了到vrf 2和vrf 3的路由，所以对于vrf 3访问global，只需要添加一条：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">R1(config)#ip route vrf 3 14.1.1.0 255.255.255.0 14.1.1.4 global</span><br><span class="line"></span><br><span class="line">vpc4&gt; ping 13.1.1.3 -c 1                &#x2F;&#x2F; vrf 3与global之间三层可达</span><br><span class="line"></span><br><span class="line">84 bytes from 13.1.1.3 icmp_seq&#x3D;1 ttl&#x3D;63 time&#x3D;2.165 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里面的一个基本思路是：如果一个vrf想要访问其它vrf的网段(无论是不是default vrf)</p><ol><li>下一跳都要指定到global中去找，global中如果没有对应的路由，就要在global中补上</li><li>同时global中一定要有返回该vrf的路由</li><li>网络是双向的，来回都需要有路由。</li></ol><p>分析下一下路由表，这是最本质的东西了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">对于vrf 2的路由表:</span><br><span class="line">R1#show ip route vrf 2 static         </span><br><span class="line">      13.0.0.0&#x2F;24 is subnetted, 1 subnets</span><br><span class="line">S        13.1.1.0 [1&#x2F;0] via 13.1.1.3                    &#x2F;&#x2F; 去往vrf 3的路由，到global中找下一跳13.1.1.3  (路由表中好像并没有什么地方体现出到global去找)</span><br><span class="line">      14.0.0.0&#x2F;24 is subnetted, 1 subnets</span><br><span class="line">S        14.1.1.0 [1&#x2F;0] via 14.1.1.4                    &#x2F;&#x2F; 去往global的路由</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 对于global路由表</span><br><span class="line">R1#show ip route static </span><br><span class="line">      12.0.0.0&#x2F;24 is subnetted, 1 subnets</span><br><span class="line">S        12.1.1.0 is directly connected, Ethernet0&#x2F;0</span><br><span class="line">      13.0.0.0&#x2F;24 is subnetted, 1 subnets</span><br><span class="line">S        13.1.1.0 is directly connected, Ethernet0&#x2F;1    &#x2F;&#x2F; 指明13.1.1.0网段的出口</span><br><span class="line"></span><br><span class="line">R1#show ip route vrf 3 static </span><br><span class="line">      12.0.0.0&#x2F;24 is subnetted, 1 subnets</span><br><span class="line">S        12.1.1.0 [1&#x2F;0] via 12.1.1.2                    &#x2F;&#x2F; 12.1.1.0的回程路由</span><br><span class="line">      14.0.0.0&#x2F;24 is subnetted, 1 subnets</span><br><span class="line">S        14.1.1.0 [1&#x2F;0] via 14.1.1.4                    </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一张图来收尾吧：<br><img src="https://rancho333.github.io/pictures/vrf_leaking_route.png"></p><p>最后再补充一点，vrf lite leaking有两种方式，一种就是上面使用的通过配置静态路由实现，另外一种方式就是使用MP-BG。对于MP-BGP的方式：</p><ol><li>在vrf中表明需要import的RT</li><li>在MP-BGP对应的vrf中redistribute相关的路由<br>本质就是将不同vrf中的路由导入到MP-BGP中去，然后再import自己感兴趣的其它vrf中的路由，这样就可以实现不同vrf之间的路由leaking.</li></ol>]]></content:encoded>
      
      
      
      <category domain="https://rancho333.github.io/tags/vrf/">vrf</category>
      
      
      <comments>https://rancho333.github.io/2022/10/13/vrf-lite-route-leaking/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>PVLAN浅析</title>
      <link>https://rancho333.github.io/2022/10/12/PVLAN%E6%B5%85%E6%9E%90/</link>
      <guid>https://rancho333.github.io/2022/10/12/PVLAN%E6%B5%85%E6%9E%90/</guid>
      <pubDate>Wed, 12 Oct 2022 10:34:00 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h1&gt;&lt;p&gt;Vlan里面有两个常见的概念：透传与终结。所谓vlan透传就是某个vlan不仅在一台交换机上有效，它还要通过某种方法延伸到别的以太网交换机上，在别的设备上照样有效，vlan透传可以通过802.1Q技术实现。&lt;br&gt;终结的意思相对，某个vlan的有效域不能再延伸到别的设备，或者不能通过某条链路延伸到别的设备。vlan的终结可以使用PVLAN技术。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Vlan里面有两个常见的概念：透传与终结。所谓vlan透传就是某个vlan不仅在一台交换机上有效，它还要通过某种方法延伸到别的以太网交换机上，在别的设备上照样有效，vlan透传可以通过802.1Q技术实现。<br>终结的意思相对，某个vlan的有效域不能再延伸到别的设备，或者不能通过某条链路延伸到别的设备。vlan的终结可以使用PVLAN技术。</p><span id="more"></span><p>本文主要浅析下PVLAN的概念以及实验验证下。</p><h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>把vlan终结掉，也就是确定vlan的边界在哪里终止，pvlan技术可以很好的实现这个功能，同时达到节省vlan的目的。cisco的PVLAN意思是private vlan，华为的意思是primary vlan. 不同叫法，基本相同的实现。</p><p>PVLAN中的vlan分成两类：primary vlan和secondary vlan(子vlan)。实现了接入用户二层报文的隔离，同时上层交换机下发的报文可以被每一个用户接收到，简化了配置，节省了vlan资源。</p><p>本文用以下拓扑来实验说明：<br><img src="https://rancho333.github.io/pictures/pvlan_topology.png"></p><p>pvlan中总是会有一个primary vlan，primary vlan中有promiscuous port。所有的端口都能和promiscuous port通信。在primary vlan中可以存在一个或多个secondary vlan，secondary vlan有两种类型：</p><ul><li>community vlan: community vlan中的成员端口可以相互通信，并且可以和promiscuous port通信</li><li>isolated vlan：成员端口之间不能通信，但是可以和promiscuous port通信。</li></ul><p>secondary vlan始终可以和promiscuous port通信，但是不同的secondary vlan之间是相互隔离的。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>实验拓扑如上所示。做一些简单说明：</p><ul><li>primary vlan的数值是100</li><li>secondary community vlan的数值是101</li><li>secondary isolated vlan的数值是102</li><li>vpc3和vpc4在community vlan中可以相互通信，并且可以和连接到promiscuous port的vpc2通信</li><li>vpc5和vpc6在isolated vlan中只能和vpc2通信</li><li>vpc2可以和所有其它vpc通信</li></ul><p>接下来就是配置了。</p><p>首先创建primary vlan和secondary vlan。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">S(config)#vtp mode off                  &#x2F;&#x2F; 首先关闭vtp，只有vtpv3支持pvlan，干脆关掉免得复杂</span><br><span class="line">Setting device to VTP Off mode for VLANS.</span><br><span class="line"></span><br><span class="line">S(config)#vlan 100              </span><br><span class="line">S(config-vlan)#private-vlan primary             &#x2F;&#x2F; 创建primary vlan</span><br><span class="line">S(config-vlan)#private-vlan association add 101     &#x2F;&#x2F; 与secondary vlan关联</span><br><span class="line">S(config-vlan)#private-vlan association add 102</span><br><span class="line"></span><br><span class="line">S(config)#vlan 101</span><br><span class="line">S(config-vlan)#private-vlan community           &#x2F;&#x2F; 创建secondary community vlan</span><br><span class="line"></span><br><span class="line">S(config)#vlan 102</span><br><span class="line">S(config-vlan)#private-vlan isolated            &#x2F;&#x2F; 创建secondary isolated vlan</span><br></pre></td></tr></table></figure><p>接下来配置接口所属的vlan.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">S(config)#interface range ethernet 0&#x2F;1-2        &#x2F;&#x2F; community vlan所属的两个端口, 属于CV 101</span><br><span class="line">S(config-if-range)#switchport mode private-vlan host    &#x2F;&#x2F; 指明这些端口是主机端口，类似于access port</span><br><span class="line">S(config-if-range)#switchport private-vlan host-association 100 101     &#x2F;&#x2F; 指明端口所属的primary vlan是100，secondary vlan是101</span><br><span class="line"></span><br><span class="line">S(config)#interface ethernet 0&#x2F;0</span><br><span class="line">S(config-if)#switchport mode private-vlan promiscuous           &#x2F;&#x2F; 指明该端口是promiscuous port</span><br><span class="line">S(config-if)#switchport private-vlan mapping 100 101            &#x2F;&#x2F; 将primary vlan与secondary vlan映射</span><br><span class="line"></span><br><span class="line">S(config)#interface ethernet 0&#x2F;3 </span><br><span class="line">S(config)#interface ethernet 1&#x2F;0       </span><br><span class="line">S(config-if)#switchport mode private-vlan host      &#x2F;&#x2F; 配置端口属于secondary isolated vlan</span><br><span class="line">S(config-if)#switchport private-vlan host-association 100 102</span><br></pre></td></tr></table></figure><p>查看下配置的状态：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 对于promiscuous port</span><br><span class="line">S#show interfaces ethernet 0&#x2F;0 switchport | include mapping     </span><br><span class="line">Administrative private-vlan mapping: 100 (VLAN0100) 101 (VLAN0101) 102 (VLAN0102)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 对于host端口</span><br><span class="line">S#show interfaces ethernet 0&#x2F;1 switchport | include host-association</span><br><span class="line">Administrative private-vlan host-association: 100 (VLAN0100) 101 (VLAN0101) </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 对于isolated端口</span><br><span class="line">S#show interfaces ethernet 0&#x2F;3 switchport | include host-association</span><br><span class="line">Administrative private-vlan host-association: 100 (VLAN0100) 102 (VLAN0102)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 查看primary vlan和secondary vlan，以及secondary的类型</span><br><span class="line">S#show vlan private-vlan </span><br><span class="line"></span><br><span class="line">Primary Secondary Type              Ports</span><br><span class="line">------- --------- ----------------- ------------------------------------------</span><br><span class="line">100     101       community         Et0&#x2F;0, Et0&#x2F;1, Et0&#x2F;2</span><br><span class="line">100     102       isolated          Et0&#x2F;3, Et1&#x2F;0</span><br></pre></td></tr></table></figure><p>接下来ping测试一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 对于community vlan的成员</span><br><span class="line">vpc3&gt; ping  192.168.1.2 -c 1            &#x2F;&#x2F; 可以ping通promiscuous port</span><br><span class="line"></span><br><span class="line">84 bytes from 192.168.1.2 icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;1.775 ms</span><br><span class="line"></span><br><span class="line">vpc3&gt; ping  192.168.1.4 -c 1            &#x2F;&#x2F; 可以ping通同secondary community的成员</span><br><span class="line"></span><br><span class="line">84 bytes from 192.168.1.4 icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;1.159 ms</span><br><span class="line"></span><br><span class="line">vpc3&gt; ping  192.168.1.5 -c 1        &#x2F;&#x2F; 不能ping通其它secondary vlan的成员</span><br><span class="line"></span><br><span class="line">host (192.168.1.5) not reachable</span><br></pre></td></tr></table></figure><p>vpc2同样可以ping通vpc3和vpc4，这里就不贴出来了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 对于isolated vlan的成员</span><br><span class="line">vpc5&gt; ping 192.168.1.6 -c 1         &#x2F;&#x2F; 不能ping通同vlan的其它成员</span><br><span class="line"></span><br><span class="line">host (192.168.1.6) not reachable</span><br><span class="line"></span><br><span class="line">vpc5&gt; ping 192.168.1.2 -c 1     &#x2F;&#x2F; 可以ping通promiscuous port</span><br><span class="line"></span><br><span class="line">84 bytes from 192.168.1.2 icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.815 ms</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; promiscuous port则可以ping通isolated vlan内的所有成员</span><br><span class="line">vpc2&gt; ping 192.168.1.5 -c 1</span><br><span class="line"></span><br><span class="line">84 bytes from 192.168.1.5 icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;1.050 ms</span><br><span class="line"></span><br><span class="line">vpc2&gt; ping 192.168.1.6 -c 1</span><br><span class="line"></span><br><span class="line">84 bytes from 192.168.1.6 icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.475 ms</span><br></pre></td></tr></table></figure><p>总结一下：<br>pvlan的实现：</p><ol><li>一定存在一个primary vlan, 里面有一个端口promiscuous port则可以ping通isolated</li><li>可以存在多个secondary vlan，secondary vlan之间不能通信，但都可与promiscuous port通信</li><li>secondary vlan分为community vlan和isolated vlan与secondary<ul><li>community vlan成员之间可以相互通信</li><li>isolated vlan成员之间不能相互通信</li><li>所有secondary vlan成员都能与promiscuous port通信</li></ul></li><li>pvlan作用域可以延伸到其它交换机，但是要保证交换机之间的链路是trunk，并允许primary vlan和secondary vlan通过 </li><li>上行设备只关心primary vlan而不会感知secondary vlan，从而节省vlan资源</li></ol><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://www.h3c.com/cn/d_201505/868804_30003_0.htm">PVLAN技术白皮书</a></p>]]></content:encoded>
      
      
      
      
      <comments>https://rancho333.github.io/2022/10/12/PVLAN%E6%B5%85%E6%9E%90/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
